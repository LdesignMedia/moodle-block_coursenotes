{"version":3,"file":"coursenotes.min.js","sources":["../src/coursenotes.js"],"sourcesContent":["import Ajax from 'core/ajax';\nimport Log from 'core/log';\n\nexport const init = () => {\n    let noteHistory = [];\n    const courseNoteExists = document.getElementById('coursenote-display').textContent.trim() !== '';\n    const textarea = document.getElementById('coursenote-textarea');\n\n    // Hide form if course note exists.\n    if (courseNoteExists) {\n        document.getElementById('coursenote-form').style.display = 'none';\n    }\n\n    document.getElementById('edit-icon').addEventListener('click', function () {\n        document.getElementById('coursenote-display').style.display = 'none';\n        this.style.display = 'none'; // Hide the edit icon itself.\n        document.getElementById('coursenote-form').style.display = 'block';\n\n        fetchNoteHistory();\n    });\n\n    document.getElementById('cancel-button').addEventListener('click', function () {\n        window.location.reload();\n        // document.getElementById('coursenote-display').style.display = 'block';\n        // document.getElementById('edit-icon').style.display = 'block'; // Show the edit icon again.\n        // document.getElementById('coursenote-form').style.display = 'none';\n    });\n\n    document.getElementById('undo-button').addEventListener('click', function () {\n        if (noteHistory.length > 1) {\n            noteHistory.pop(); // Remove current note.\n            const lastNote = noteHistory[noteHistory.length - 1];\n            document.getElementById('coursenote-textarea').value = lastNote;\n            if (noteHistory.length <= 1) {\n                this.style.display = 'none'; // Hide undo button if only one note left.\n            }\n        }\n    });\n\n    let timeoutId;\n    const courseId = textarea.dataset.courseid;\n\n    textarea.addEventListener('input', () => {\n        clearTimeout(timeoutId);\n\n        if (textarea.value.length > 10) {\n            timeoutId = setTimeout(() => {\n                saveNoteAJAX(textarea.value);\n            }, 10000);\n        }\n    });\n    const saveNoteAJAX = (note) => {\n        let formattedNote;\n        formattedNote = stripHtmlTags(note);\n        Ajax.call([{\n            methodname: 'block_coursenotes_save_note',\n            args: {\n                coursenote: formattedNote,\n                courseid: courseId\n            },\n            done: (response) => {\n                if (response.status) {\n                    noteHistory.push(note);\n                    noteHistory.shift();\n                    Log.log('Note saved successfully');\n                } else {\n                    Log.log('Error saving note:', response.message);\n                }\n            },\n            fail: (error) => {\n                Log.error('AJAX error: ' + JSON.stringify(error));\n            }\n        }]);\n    };\n\n    const stripHtmlTags = (str) => {\n        return str.replace(/<\\/?[^>]+(>|$)/g, \"\");\n    };\n\n    const fetchNoteHistory = () => {\n        Ajax.call([{\n            methodname: 'block_coursenotes_fetch_notes',\n            args: {\n                courseid: courseId\n            },\n            done: (response) => {\n                if (response.status) {\n                    noteHistory = response.notes;\n                    if (response.note_count > 1) {\n                        document.getElementById('undo-button').style.display = 'block';\n                    } else {\n                        document.getElementById('undo-button').style.display = 'none';\n                    }\n                    Log.log('Note history fetched successfully');\n                } else {\n                    Log.log('Error fetching note history:', response.message);\n                }\n            },\n            fail: (error) => {\n                Log.error('AJAX error: ' + JSON.stringify(error));\n            }\n        }]);\n    };\n};\n"],"names":["noteHistory","courseNoteExists","document","getElementById","textContent","trim","textarea","timeoutId","style","display","addEventListener","fetchNoteHistory","window","location","reload","length","pop","lastNote","value","courseId","dataset","courseid","clearTimeout","setTimeout","saveNoteAJAX","note","formattedNote","stripHtmlTags","call","methodname","args","coursenote","done","response","status","push","shift","log","message","fail","error","JSON","stringify","str","replace","notes","note_count"],"mappings":"4VAGoB,SACZA,YAAc,SACZC,iBAAwF,KAArEC,SAASC,eAAe,sBAAsBC,YAAYC,OAC7EC,SAAWJ,SAASC,eAAe,2BAiCrCI,UA9BAN,mBACAC,SAASC,eAAe,mBAAmBK,MAAMC,QAAU,QAG/DP,SAASC,eAAe,aAAaO,iBAAiB,SAAS,WAC3DR,SAASC,eAAe,sBAAsBK,MAAMC,QAAU,YACzDD,MAAMC,QAAU,OACrBP,SAASC,eAAe,mBAAmBK,MAAMC,QAAU,QAE3DE,sBAGJT,SAASC,eAAe,iBAAiBO,iBAAiB,SAAS,WAC/DE,OAAOC,SAASC,YAMpBZ,SAASC,eAAe,eAAeO,iBAAiB,SAAS,cACzDV,YAAYe,OAAS,EAAG,CACxBf,YAAYgB,YACNC,SAAWjB,YAAYA,YAAYe,OAAS,GAClDb,SAASC,eAAe,uBAAuBe,MAAQD,SACnDjB,YAAYe,QAAU,SACjBP,MAAMC,QAAU,kBAM3BU,SAAWb,SAASc,QAAQC,SAElCf,SAASI,iBAAiB,SAAS,KAC/BY,aAAaf,WAETD,SAASY,MAAMH,OAAS,KACxBR,UAAYgB,YAAW,KACnBC,aAAalB,SAASY,SACvB,eAGLM,aAAgBC,WACdC,cACJA,cAAgBC,cAAcF,oBACzBG,KAAK,CAAC,CACPC,WAAY,8BACZC,KAAM,CACFC,WAAYL,cACZL,SAAUF,UAEda,KAAOC,WACCA,SAASC,QACTlC,YAAYmC,KAAKV,MACjBzB,YAAYoC,qBACRC,IAAI,yCAEJA,IAAI,qBAAsBJ,SAASK,UAG/CC,KAAOC,qBACCA,MAAM,eAAiBC,KAAKC,UAAUF,aAKhDb,cAAiBgB,KACZA,IAAIC,QAAQ,kBAAmB,IAGpCjC,iBAAmB,mBAChBiB,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CACFT,SAAUF,UAEda,KAAOC,WACCA,SAASC,QACTlC,YAAciC,SAASY,MACnBZ,SAASa,WAAa,EACtB5C,SAASC,eAAe,eAAeK,MAAMC,QAAU,QAEvDP,SAASC,eAAe,eAAeK,MAAMC,QAAU,oBAEvD4B,IAAI,mDAEJA,IAAI,+BAAgCJ,SAASK,UAGzDC,KAAOC,qBACCA,MAAM,eAAiBC,KAAKC,UAAUF"}